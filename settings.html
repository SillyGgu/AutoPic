

<div class="inline-drawer">
    <div class="inline-drawer-toggle inline-drawer-header">
        <b data-i18n="Image Auto Generation" style="color: #4a90e2;">ì˜¤í† í”½:ì´ë¯¸ì§€ ìë™ ìƒì„±</b>
        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
    </div>
    <div class="inline-drawer-content" style="padding: 15px; background-color: #1a1a1c; border-radius: 0 0 8px 8px; color: #ffffff;">
        
        <!-- ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ íƒ­ -->
        <div class="image-gen-nav-container">
            <div class="image-gen-nav-item active" data-tab="tab-gen-general">âš™ï¸ ê¸°ë³¸ ì„¤ì •</div>
            <div class="image-gen-nav-item" data-tab="tab-gen-templates">ğŸ¨ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿</div>
            <div class="image-gen-nav-item" data-tab="tab-gen-linking">ğŸ”— ìºë¦­í„° ì—°ë™</div>
        </div>
        
        <!-- 1. ê¸°ë³¸ ì„¤ì • íƒ­ -->
        <div id="tab-gen-general" class="image-gen-tab-content active">
            <div class="image-gen-card">
                <h3 class="gen-section-title">ì‘ë™ ë°©ì‹</h3>
                <div class="flex-container flexnowrap margin-bottom-15" style="align-items: center; gap: 20px;">
                    <label for="image_generation_insert_type" style="flex-shrink: 0; min-width: 120px;">ì´ë¯¸ì§€ ì‚½ì… ìœ í˜•</label>
                    <select id="image_generation_insert_type" class="gen-custom-input flex1">
                        <option value="inline">í˜„ì¬ ë©”ì‹œì§€ì— ì‚½ì…</option>
                        <option value="replace">íƒœê·¸ ì¹˜í™˜ ëª¨ë“œ</option>
                        <option value="new">ìƒˆ ë©”ì‹œì§€ë¡œ ìƒì„±</option>
                        <option value="disabled">ì‚¬ìš© ì•ˆ í•¨</option>
                    </select>
                </div>
                <div class="flex-container flexnowrap" style="margin-top: 10px;">
                    <label class="gen-checkbox-label" for="prompt_injection_enabled">
                        <input type="checkbox" id="prompt_injection_enabled">
                        <span>í”„ë¡¬í”„íŠ¸ ì£¼ì… í™œì„±í™”</span>
                    </label>
                </div>
            </div>

            <div class="image-gen-card">
                <h3 class="gen-section-title">ê³ ê¸‰ ì¸ì ì…˜ ì„¤ì •</h3>
                <div style="margin-bottom: 25px;">
                    <label style="display:block; margin-bottom:5px; margin-top:5px; font-size:0.85rem; color: #cccccc; font-weight: bold;">ì¶”ì¶œ ì •ê·œì‹ (Regex)</label>
                    <textarea id="prompt_injection_regex" class="gen-custom-input" rows="2" placeholder="ì˜ˆ: /<pic[^>]*\sprompt=([^>]*?)>/g"></textarea>
                </div>
                <div class="flex-container flexnowrap margin-bottom-15" style="align-items: center; gap: 20px;">
                    <label style="flex-shrink: 0; min-width: 120px;">ì£¼ì… ìœ„ì¹˜</label>
                    <select id="prompt_injection_position" class="gen-custom-input flex1">
                        <option value="deep_system">System (ê¶Œì¥)</option>
                        <option value="deep_user">User</option>
                        <option value="deep_assistant">AI Assistant</option>
                    </select>
                </div>
                <div class="flex-container flexnowrap" style="align-items: center; gap: 20px;">
                    <label style="flex-shrink: 0; min-width: 120px;">ì£¼ì… ê¹Šì´ (Depth)</label>
                    <input id="prompt_injection_depth" class="gen-custom-input" type="number" min="0" max="100" style="width: 80px;">
                </div>
            </div>
        </div>

        <!-- 2. í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ íƒ­ -->
        <div id="tab-gen-templates" class="image-gen-tab-content">
			<div class="image-gen-card">
				<h3 class="gen-section-title">í…œí”Œë¦¿ ê´€ë¦¬</h3>
				<p style="font-size: 0.82rem; color: #ff9f43; margin-top: 9px; margin-bottom: 20px; line-height: 1.4;">
					<i class="fa-solid fa-circle-info"></i> <b>ì°¸ê³ :</b> ìˆ˜ì • í›„ <b>ì €ì¥</b> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê¸°ì¡´ ë‚´ìš©ì— ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤. <b>+</b> ë²„íŠ¼ì€ ìƒˆ í…œí”Œë¦¿ì„ ì ê¸° ìœ„í•´ ì°½ì„ ë¹„ì›ë‹ˆë‹¤.
				</p>
				
				<div class="flex-container flexnowrap" style="align-items: center; margin-bottom: 25px; gap: 8px; margin-top: 10px;">
					<select id="prompt_preset_select" class="gen-custom-input" style="flex: 1;">
						<option value="" id="preset_default_option">-- í…œí”Œë¦¿ ì„ íƒ --</option>
					</select>
                    <button id="add_new_prompt_preset" class="gen-btn gen-btn-dark" title="ìƒˆ í…œí”Œë¦¿ ì¶”ê°€ (ì…ë ¥ì°½ ë¹„ìš°ê¸°)">
						<i class="fa-solid fa-plus"></i>
					</button>
                    <button id="rename_prompt_preset" class="gen-btn gen-btn-gray" title="ì´ë¦„ ìˆ˜ì •">
						<i class="fa-solid fa-pen-to-square"></i>
					</button>
					<button id="save_prompt_preset" class="gen-btn gen-btn-blue" title="ì €ì¥ (ë®ì–´ì”Œìš°ê¸°/ìƒˆë¡œì €ì¥)">
						<i class="fa-solid fa-floppy-disk"></i>
					</button>
					<button id="delete_prompt_preset" class="gen-btn gen-btn-red" title="ì‚­ì œ">
						<i class="fa-solid fa-trash"></i>
					</button>
				</div>
				<div>
					<label style="display:block; margin-bottom:10px; font-size:0.85rem; font-weight:bold; color: #4a90e2;">í”„ë¡¬í”„íŠ¸ ë‚´ìš©</label>
					<textarea id="prompt_injection_text" class="gen-custom-input" rows="10" placeholder="AIì—ê²Œ ì´ë¯¸ì§€ íƒœê·¸ ìƒì„±ì„ ì§€ì‹œí•˜ëŠ” í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></textarea>
				</div>
			</div>
		</div>

        <!-- 3. ìºë¦­í„° ì—°ë™ íƒ­ -->
        <div id="tab-gen-linking" class="image-gen-tab-content">
            <div class="image-gen-card">
                <h3 class="gen-section-title">ğŸ”— ìºë¦­í„°ë³„ í”„ë¡¬í”„íŠ¸ ì—°ë™</h3>
                <p style="font-size: 0.85rem; color: #aaaaaa; margin-bottom: 15px; line-height: 1.4;">
                    íŠ¹ì • ìºë¦­í„°ì—ê²Œ íŠ¹í™”ëœ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                
                <div style="background: #121214; padding: 15px; border-radius: 10px; border: 1px solid #333336; margin-bottom: 15px;">
                    <div id="gen-char-link-info-area" style="font-size: 0.9rem; line-height: 1.6; color: #eeeeee;">
                        ìºë¦­í„° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </div>
                </div>

                <div class="flex-container flexGap10">
                    <button id="gen-save-char-link-btn" class="gen-btn gen-btn-blue flex2" style="height: 42px; font-weight: bold;">
                        <i class="fa-solid fa-link"></i> í˜„ì¬ ìºë¦­í„°ì— ì—°ë™
                    </button>
                    <button id="gen-remove-char-link-btn" class="gen-btn gen-btn-gray flex1" style="height: 42px;">
                        ì—°ë™ í•´ì œ
                    </button>
                </div>

                <div style="margin-top: 15px;">
                    <button id="gen-toggle-linked-list-btn" class="gen-btn gen-btn-dark" style="width: 100%; justify-content: center;">
                        ğŸ“‹ ì—°ë™ëœ ìºë¦­í„° ëª©ë¡ í™•ì¸
                    </button>
                    <div id="gen-linked-char-list-container" style="display: none; margin-top: 10px; max-height: 250px; overflow-y: auto; border: 1px solid #333336; border-radius: 8px; background: #121214;">
                        <!-- JSì—ì„œ ë Œë”ë§ -->
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<style>
/* íƒ­ ë””ìì¸ */
.image-gen-nav-container {
    display: flex; 
    flex-wrap: wrap;
    gap: 5px; 
    margin-bottom: 20px; 
    padding-bottom: 5px;
    border-bottom: 2px solid #333336;
}

.image-gen-nav-item {
    padding: 10px 8px; 
    cursor: pointer; 
    font-weight: 600; 
    color: #888888; 
    border-radius: 8px 8px 0 0; 
    transition: all 0.2s ease; 
    white-space: nowrap; 
    font-size: 0.8rem; 
    background-color: #252529;
    flex: 1;         
    min-width: 70px;
    text-align: center;
    overflow: hidden;
    text-overflow: ellipsis; 
}
.image-gen-nav-item:hover { 
    background-color: #303035; 
    color: #ffffff; 
}
.image-gen-nav-item.active { 
    background-color: #4a90e2; 
    color: #ffffff; 
}

/* ì¹´ë“œí˜• ì„¹ì…˜ */
.image-gen-card {
    background-color: #252529;
    padding: 22px;
    border-radius: 12px;
    border: 1px solid #333336;
    margin-bottom: 20px;
}

.image-gen-tab-content { display: none; }
.image-gen-tab-content.active { display: block; animation: fadeInGen 0.3s ease-out; }

@keyframes fadeInGen {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
}

.gen-section-title {
    font-size: 1.05rem; font-weight: bold; margin-bottom: 22px; color: #4a90e2;
    display: flex; align-items: center; gap: 10px; border: none; margin-top: 0;
}
.gen-section-title::after {
    content: ""; flex-grow: 1; height: 1px; background: #333336;
}

/* ê³µí†µ ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
.gen-custom-input {
    background-color: #121214 !important;
    color: #ffffff !important;
    border: 1px solid #444448 !important;
    border-radius: 8px !important;
    padding: 8px 12px !important;
    font-size: 0.9rem !important;
    outline: none !important;
    box-sizing: border-box;
}

/* ë“œë¡­ë‹¤ìš´ ê³¡ë¥  ë° í™”ì‚´í‘œ ì²˜ë¦¬ */
select.gen-custom-input {
    appearance: none !important;
    -webkit-appearance: none !important;
    background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20stroke%3D%22%23cccccc%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C/polyline%3E%3C/svg%3E") !important;
    background-repeat: no-repeat !important;
    background-position: right 10px center !important;
    background-size: 16px !important;
    padding-right: 40px !important;
}

.gen-custom-input:focus {
    border-color: #4a90e2 !important;
    box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.3);
}
textarea.gen-custom-input {
    width: 100%;
    resize: vertical;
    line-height: 1.5;
}

/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.gen-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 8px 16px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 0.85rem;
    transition: filter 0.2s, transform 0.1s;
    color: #ffffff !important;
    white-space: nowrap; /* í…ìŠ¤íŠ¸ ì„¸ë¡œ ë°©ì§€ */
    min-width: fit-content;
}
.gen-btn:active { transform: scale(0.97); }
.gen-btn:hover { filter: brightness(1.2); }

.gen-btn-blue { background-color: #4a90e2 !important; }
.gen-btn-red { background-color: #eb4d4b !important; }
.gen-btn-gray { background-color: #4b4b4e !important; }
.gen-btn-dark { background-color: #121214 !important; border: 1px solid #333336 !important; }

/* 1. ì²´í¬ë°•ìŠ¤ ë””ìì¸ ê°•í™” (ë°°ê²½ê²€ì • ëŒ€ë¹„) */
.gen-checkbox-label {
    display: flex; align-items: center; gap: 12px; cursor: pointer; font-size: 0.95rem; color: #eeeeee;
}
.gen-checkbox-label input[type="checkbox"] {
    -webkit-appearance: none;
    appearance: none;
    width: 20px; height: 20px;
    border: 2px solid #4a90e2; /* íŒŒë€ìƒ‰ í…Œë‘ë¦¬ë¡œ ì‹œì¸ì„± í™•ë³´ */
    border-radius: 4px;
    background-color: #121214; /* ë‚´ë¶€ ê²€ì • */
    cursor: pointer;
    position: relative;
    transition: background 0.2s, border-color 0.2s;
    margin: 0;
}
.gen-checkbox-label input[type="checkbox"]:checked {
    background-color: #4a90e2; /* ì²´í¬ ì‹œ ë°°ê²½ íŒŒë€ìƒ‰ */
    border-color: #4a90e2;
}
.gen-checkbox-label input[type="checkbox"]:checked::after {
    content: 'âœ”';
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 14px;
    font-weight: bold;
}
.gen-checkbox-label input[type="checkbox"]:hover {
    border-color: #74b9ff;
}

/* 2. ëª©ë¡ ì•„ì´í…œ ë ˆì´ì•„ì›ƒ ë° ë²„íŠ¼ ìˆ˜ì • */
.gen-linked-item {
    display: flex; justify-content: space-between; align-items: center; padding: 14px;
    border-bottom: 1px solid #252529;
    gap: 15px;
}
.gen-linked-item:last-child { border-bottom: none; }
.gen-linked-item:hover { background: #1a1a1c; }

.gen-delete-link-btn {
    padding: 6px 12px !important;
    height: 32px;
    font-size: 0.8rem !important;
    flex-shrink: 0; /* ë²„íŠ¼ ì••ì¶• ë°©ì§€ */
}

/* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
#gen-linked-char-list-container::-webkit-scrollbar { width: 8px; }
#gen-linked-char-list-container::-webkit-scrollbar-track { background: #121214; }
#gen-linked-char-list-container::-webkit-scrollbar-thumb { background: #333336; border-radius: 4px; }

.margin-bottom-15 { margin-bottom: 15px !important; }

@media screen and (max-width: 500px) {
    /* íƒ­ ë©”ë‰´ í°íŠ¸ ì¶”ê°€ ì¶•ì†Œ */
    .image-gen-nav-item {
        font-size: 0.75rem;
        padding: 8px 4px;
    }

    /* ì„¤ì • í•­ëª© ì¤„ë°”ê¿ˆ í—ˆìš© */
    .flex-container.flexnowrap {
        flex-wrap: wrap !important;
        gap: 8px !important;
    }

    /* ë¼ë²¨ ë„ˆë¹„ë¥¼ 100%ë¡œ ë„“í˜€ì„œ ì…ë ¥ì°½ì´ ì•„ë˜ë¡œ ë‚´ë ¤ê°€ê²Œ í•¨ */
    .flex-container label {
        min-width: 100% !important;
        flex-basis: 100%;
        margin-bottom: 4px;
    }
    
    /* ì…ë ¥ì°½ ë° ì…€ë ‰íŠ¸ë°•ìŠ¤ ë„ˆë¹„ ìµœì í™” */
    .gen-custom-input {
        width: 100% !important;
        flex: 1 1 100%;
    }

    /* í…œí”Œë¦¿ ê´€ë¦¬ ë²„íŠ¼ ë ˆì´ì•„ì›ƒ ì¡°ì • */
    #tab-gen-templates .flex-container {
        flex-wrap: wrap;
    }
    #prompt_preset_select {
        min-width: 100%;
        margin-bottom: 8px;
    }
}
</style>